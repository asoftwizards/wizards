<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://www.asoft.ru/xml/st" id="GPN">
	<embed filename="/usr/local/effi/doc/types/BASETYPE.xml"/>
	<embed filename="/usr/local/effi/doc/types/AUTHORIZERTYPE.xml"/>
	<embed filename="GPNTYPE.xml"/>
	<parent filename="/usr/local/effi/include/Services/Authorizer/AUTHORIZER.xml"/>

	<class id="GPNUser" title="Сотрудник" >
		<fields>
                        <TokenID type="LONG" key="pk" title="Код пользователя"/>
                        <LastName type="NAME" title="Фамилия" notnull="yes"/>
                        <FirstName type="NAME" title="Имя" notnull="yes"/>
                        <SecondName type="NAME" title="Отчество"/>
			<UStatus type="USER_STATUS" title="Статус" notnull="yes"/>
			<Organization title="Организация" notnull="yes" />

			<FullName type="NAME" title="ФИО" virtual="yes" />
			<Groups type="NAME" title="Группы доступа" virtual="yes" />
                        <Login type="LOGIN" title="Логин" virtual="yes"/>
                        <Password type="PASSWD" title="Пароль" virtual="yes"/>
                        <PasswordConfirm type="PASSWD" title="Подтверждение Пароля" virtual="yes"/>
                        <GroupsList type="COLLECTOR" src="/act/Authorizer/GroupsListPopup" rets="TokenID TokenName" show="TokenName" virtual="yes" title="Группы Доступа"/> 

		</fields>
		<method id="Get" >
			<arg field="TokenID" ret="yes"/>
			<ret field="LastName" />
			<ret field="FirstName" />
			<ret field="SecondName" />
			<ret field="Name" class="Organization" />
			<ret field="Login" />
			<ret field="GroupsList" />
			<ret field="UStatus" />
		</method>
		<wnd id="GPNUserGet" title="Пользователь" >
			<field id="TokenID" />
			<field id="LastName"/>
			<field id="FirstName"/>
			<field id="SecondName"/>
			<field id="Name" class="Organization" />
			<field id="Login"/>
			<field id="GroupsList"/>
			<field id="UStatus"/>
			<init>
				<method id="Get" args="TokenID" />
			</init>
			<button id="Edit" title="Edit" >
				<wnd id="GPNUserUpdate" args="TokenID" />
			</button>
			<button id="Cancel" title="Cancel">
				<wnd id="GPNUserList" />
			</button>	
		</wnd>
		<method id="Add" >
			<arg field="LastName" />
			<arg field="FirstName" />
			<arg field="SecondName" />
			<arg field="OrgID" />
			<arg field="Login" />
			<arg field="Password" />
			<arg field="PasswordConfirm"/>
        	        <arg field="GroupsList"/>
		</method>
		<method id="Update" >
			<arg field="TokenID" />
			<arg field="LastName" optional="yes" />
			<arg field="FirstName" optional="yes" />
			<arg field="SecondName" optional="yes" />
			<arg field="OrgID" optional="yes" />
			<arg field="Login" optional="yes" />
<!--			<arg field="Password" optional="yes" />
			<arg field="PasswordConfirm" optional="yes" /> -->
        	        <arg field="GroupsList" optional="yes" />
        	        <arg field="UStatus" optional="yes" />
		</method>
		<wnd id="GPNUserUpdate" >
			<field id="TokenID" visibility="vo" ret="yes"/>
			<field id="LastName"/>
			<field id="FirstName"/>
			<field id="SecondName"/>
			<field id="Organization" />
			<field id="Login"/>
			<field id="GroupsList"/>
			<field id="UStatus"/>
			<init>
				<method id="Get" args="TokenID" />
			</init>
			<button id="Update" title="Update" >
				<method id="Update" />
                                <wnd id="GPNUserGet" args="TokenID" />
			</button>
			<button id="Cancel" title="Cancel">
				<wnd id="GPNUserGet" args="TokenID" />
			</button>	
		</wnd>
		<method id="AddWithTokenID" category="add">
			<arg field="TokenID"/>
			<arg field="LastName"/>
			<arg field="FirstName"/>
			<arg field="SecondName"/>
			<arg field="Organization" />
			<arg field="Login"/>
			<arg field="Password"/>
			<arg field="PasswordConfirm"/>
			<arg field="GroupsList"/>
		</method>

		<method id="Activate" >
			<arg field="TokenID" />
		</method>
		<method id="Block" >
			<arg field="TokenID" />
		</method>
		<method id="GPNUserListGet" >
			<arg field="OrgID" optional="yes" />
		</method>
		<view id="GPNUserList" title="Сотрудники">
			<column field="TokenID" ret="yes" />
			<column field="FullName" />
			<column field="Name" class="Organization" />
			<column field="Login" />
			<column field="Groups" />
			<column field="UStatus" />
			<init>
				<method id="GPNUserListGet" />
			</init>
			<button id="Activate" title="Активировать" >
				<method id="Activate" args="TokenID=GPNUserList.TokenID" />
                                <evt type="WM_REFRESH" id="GPNUserList"/>
			</button>
			<button id="Block" title="Блокировать" >
				<method id="Block" args="TokenID=GPNUserList.TokenID" />
                                <evt type="WM_REFRESH" id="GPNUserList"/>
			</button>
		</view>
	</class>

	<class id="Organization" title="Подрядная организация" >
		<fields>
			<OrgID type="ID" key="sk" title="Код организации" />
			<Name type="NAME" title="Название" notnull="yes" />
			<Address type="TEXT" title="Адрес" />
			<LAddress type="TEXT" title="Юридический адрес" />
		</fields>
		<view id="OrganizationList" title="Организации" >
			<column field="OrgID" ret="yes" />
			<column field="Name" ret="yes" />
			<column field="Address" />
			<column field="LAddress" />
		</view>
	</class>

<!--	<class id="Employment" title="Работа" >
		<fields>
			<GPNUser key="pk" title="Код пользователя"/>
			<GPNProject key="pk" title="Код организации" />
		</fields>
	</class> -->

	<class id="Contract" title="Договор подряда" >
		<fields>
			<ContractID type="ID" key="sk" title="Код контракта" />
			<Name type="NAME" title="Номер" notnull="yes" />
			<BDate type="DATE" title="Дата начала" notnull="yes"/>
			<EDate type="DATE" title="Дата окончания" notnull="yes"/>

			<Executer ref="Organization" title="Подрядная организация" />
		</fields>
		<folder id="ContractFolder" title="Договор">
			<field id="ContractID" />
			<elem wnd="ContractGet" args="ContractID" title="General" />
			<elem wnd="EquipmentPointList" args="ContractID" title="Скважины" />
			<elem wnd="EquipmentList" args="OwnerOrgID=ExecuterOrgID" title="Оборудование" />
		</folder>
		<method id="ContractListGet" >
			<arg field="ExecuterOrgID" optional="yes" />
		</method>
		<view id="ContractList" title="Договор" >
			<column field="ContractID" ret="yes" />
			<column field="Name" ret="yes" />
			<column field="BDate" />
			<column field="EDate" />
			<column field="Name" alias="executer" class="Organization" title="Подрядная организация" />

			<left-join with="Organization" alias="executer" >
				<and left-field="ExecuterOrgID" compare="=" right-alias="executer" right-class="Organization" right-field="OrgID" />
			</left-join>
		</view>
	</class>

    <class id="Calculation" title="Расчет">
        <fields>
            <CalcID type="ID" key="sk" title="Код расчета" />
            <Contract/>
            <p1 type="DOUBLE" title="p1" />
            <p2 type="DOUBLE" title="p2" />

        </fields>

	<view id="CalculationList" title="Расчеты" >
		<column field="CalcID" />
		<column field="ContractID" class="Contract" />
		<column field="Name" class="Contract" />
		<select>
                                <and left-field="ContractID" compare="=" right-class="Contract" right-field="ContractID" />
		</select>
	</view>

    </class>

	<class id="EquipmentPoint" title="Скважина" >
		<fields>
			<PointID type="ID" key="sk" title="Код скважины" hidden="yes" />
			<Contract notnull="yes" title="Договор подряда"/>
			<Name type="NAME" notnull="yes" title="Название точки" />
			<Number type="NAME" notnull="yes" title="Номер точки" />
			<X type="DOUBLE" notnull="yes" title="Долгота" min="-180" max="180" decimal-accuracy="10" />
			<Y type="DOUBLE" notnull="yes" title="Широта" min="-90" max="90" decimal-accuracy="10" />
			<H type="DOUBLE" title="Глубина" />
		</fields>

		<view id="EquipmentPointList" title="Скважина" >
			<column field="PointID" ret="yes" />
			<column field="Name" ret="yes" />
			<column field="Number" />
			<column field="ContractID" />
			<column field="Name" class="Contract" alias="mcp" />
			<column field="X" />
			<column field="Y" />
			<column field="H" />
                        <select>
                                <and left-field="ContractID" compare="=" right-alias="mcp" right-class="Contract" right-field="ContractID" />
			</select>
		</view>
	</class>
	<class id="EquipmentKind" title="Типы оборудования" >
		<fields>
			<EquipKindID type="ID" key="sk" title="Код типа оборудования" hidden="yes" />
			<Kind type="EQUIP_KIND" title="Оборудование" />
			<Name type="NAME" title="Модель" />
		</fields>
		<view id="EquipmentKindList" title="Типы оборудования" >
			<column field="EquipKindID" ret="yes" />
			<column field="Name" ret="yes" />
		</view>
		<view id="PompMenuList" title="Насосы" >
			<column field="EquipKindID" ret="yes" />
			<column field="Name" />
			<select>
				<and left-field="Kind" compare="=" literal="POMP" />
			</select>
		</view>
	</class>


	<class id="Equipment" title="Оборудование" >
		<fields>
			<EquipID type="ID" key="sk" title="Код записи" hidden="yes" />
			<EquipmentKind title="Оборудование" notnull="yes" />
                        <InvNumber type="NAME" notnull="yes" title="Инвентаризационный номер" />

			<EStatus type="EQUIPMENT_STATUS" title="Статус" notnull="yes" />
			<EState type="EQUIPMENT_STATE" title="Состояние" notnull="yes" />
			<Owner ref="Organization" notnull="yes" title="Организация" />

		</fields>
                <view id="EquipmentList" title="Оборудование" exclude="AddEquipment" >
                        <column field="EquipID" ret="yes"/>
                        <column field="Kind" class="EquipmentKind" alias="EType" title="Оборудование" />
                        <column field="Name" class="EquipmentKind" alias="EType" title="Оборудование" />
                        <column field="InvNumber" />
			<column field="EStatus" />

                        <select>
				<and left-field="EquipKindID" compare="=" right-alias="EType" right-class="EquipmentKind" right-field="EquipKindID" />
				<and left-field="OwnerOrgID" compare="=" right-class="Organization" right-field="OrgID" />
                        </select>

                </view>
		<method id="EquipmentMenuListGet" >
			<arg field="EquipmentKind" optional="yes" />
		</method>
                <view id="EquipmentMenuList" title="Оборудование проектов" exclude="AddEquipment" >
                        <column field="EquipID" ret="yes"/>
                        <column field="Kind" class="EquipmentKind" alias="EType" title="Оборудование" />
                        <column field="Name" class="EquipmentKind" alias="EType" title="Модель" />
                        <column field="InvNumber" />
			<column field="EStatus" />
			<column field="EState" />

<!--                        <select>
				<and left-field="EquipKindID" compare="=" right-alias="EType" right-class="EquipmentKind" right-field="EquipKindID" />
				<and left-field="ProducerOrgID" left-class="EquipType" left-alias="EType" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
				<and left-field="ShipperOrgID" compare="=" right-alias="Shipper" right-class="Organization" right-field="OrgID" />
                        </select>
-->
                </view>


	</class>
	<class id="Pomp" title="Насос" parent="Equipment" >
		<fields>
			<Power type="DOUBLE" notnull="yes" title="Мощность" />
			<Capacity type="INT" notnull="yes" title="Производительность" />
		</fields>
<!--		<method id="Add" >
			<arg field="InvNumber" />
			<arg field="Power" />
			<arg field="Capacity" />
			<ret field="EquipID" />
		</method> -->
		<view id="PompList" title="Насосы" exclude="AddPomp Delete ">
			<column field="EquipID" />
			<column field="EquipKindID" class="EquipmentKind" alis="EKind" />
			<column field="Name" class="EquipmentKind" alis="EKind" />
                        <column field="InvNumber" class="Equipment" />
			<column field="Power" />
			<column field="Capacity" />
                        <select>
				<and left-field="EquipID" compare="=" right-class="Equipment" right-field="EquipID" />
				<and left-field="EquipKindID" left-class="Equipment" compare="=" right-alias="EKind" right-class="EquipmentKind" right-field="EquipKindID" />
                        </select>
		</view>
	</class>

	<class id="LifeCycle" >
		<fields>	
			<CycleID type="ID" key="sk" title="Код" hidden="yes" />
			<Equipment title="Оборудование" />
			<Status type="EQUIPMENT_STATUS" title="Статус" notnull="yes" />
			<State type="EQUIPMENT_STATE" title="Состояние" notnull="yes" />
			<BDate type="TIMESTAMP" title="Начало" notnull="yes"/>
			<EDate type="TIMESTAMP" title="Окончание" notnull="yes"/>
		</fields>
	</class>


	<class id="Integration" virtual="yes" >
		<fields>
			
		</fields>
		<wnd id="Integration1C" title="1С">
		</wnd>
		<wnd id="IntegrationMehfond" title="ЭРА:Мехфонд">	
		</wnd>
	</class>

<menu id="MainMenu">
	<elem id="TreeRoot" title="GPN" >
		<elem id="Contracts" title="Договора подряда" >
			<elem id="All" title="Договора подряда" src="/act/GPN/ContractList"/>
		</elem>
		<elem id="Equipments" title="Оборудование" >
			<elem id="EStore" title="Оборудование" src="/act/GPN/EquipmentMenuList"/>
		</elem>
		<elem id="Intergartion" title="Интеграция" >
			<elem id="Int1C" title="1C" src="/act/GPN/Integration1C"/>
			<elem id="IntMehfond" title="ЭРА:Мехфонд" src="/act/GPN/IntegrationMehfond"/>
		</elem>
		<elem id="Reports" title="Отчеты" >
		</elem>
		<elem id="Books" title="Справочники" >
				<elem id="Executers" title="Подрядные организации" src="/act/GPN/OrganizationList" />
				<elem id="Users" title="Пользователи" src="/act/GPN/GPNUserList" />
			<elem id="EquipmentsBook" title="Оборудование" >
				<elem id="PompsBook" title="Насосы" src="/act/GPN/PompMenuList" />
			</elem>
		</elem>
                <elem id="Settings" title="Настройки" >
                        <elem id="AccessControl" title="Доступ">
                                  <elem id="Groups" src="/act/Authorizer/GroupsList" title="Группы Доступа"/>
                                  <elem id="APrivileges" src="/act/Authorizer/APrivilegesList" title="Привилегии"/>
                                  <elem id="VC" src="/act/Authorizer/VCList" title="VC"/>
                        </elem>
			<elem id="QueryStore" title="Отчеты" src="/act/Reporter/QueryFolderStoredQueryList" />
                </elem>

<!--                <elem id="Groups" src="/act/GPN/GPNUserList" title="Пользователи"/> -->
		</elem>
        </menu>



</project>
