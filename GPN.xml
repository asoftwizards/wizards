<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://www.asoft.ru/xml/st" id="GPN">
	<embed filename="/usr/local/effi/doc/types/BASETYPE.xml"/>
	<embed filename="/usr/local/effi/doc/types/AUTHORIZERTYPE.xml"/>
	<embed filename="GPNTYPE.xml"/>
	<parent filename="/usr/local/effi/include/Services/Authorizer/AUTHORIZER.xml"/>

	<class id="GPNUser" title="Пользователь" >
		<fields>
                        <TokenID type="LONG" key="pk" title="Код пользователя"/>
                        <LastName type="NAME" title="Фамилия" notnull="yes"/>
                        <FirstName type="NAME" title="Имя" notnull="yes"/>
                        <SecondName type="NAME" title="Отчество"/>
			<UStatus type="USER_STATUS" title="Статус" notnull="yes"/>

			<FullName type="NAME" title="ФИО" virtual="yes" />
			<Groups type="NAME" title="Группы доступа" virtual="yes" />
                        <Login type="LOGIN" title="Логин" virtual="yes"/>
                        <Password type="PASSWD" title="Пароль" virtual="yes"/>
                        <PasswordConfirm type="PASSWD" title="Подтверждение Пароля" virtual="yes"/>
                        <GroupsList type="COLLECTOR" src="/act/Authorizer/GroupsListPopup" rets="TokenID TokenName" show="TokenName" virtual="yes" title="Группы Доступа"/> 

		</fields>
		<method id="Get" >
			<arg field="TokenID" ret="yes"/>
			<ret field="LastName" />
			<ret field="FirstName" />
			<ret field="SecondName" />
			<ret field="Login" />
			<ret field="GroupsList" />
			<ret field="UStatus" />
		</method>
		<wnd id="GPNUserGet" title="Пользователь" >
			<field id="TokenID" />
			<field id="LastName"/>
			<field id="FirstName"/>
			<field id="SecondName"/>
			<field id="Login"/>
			<field id="GroupsList"/>
			<field id="UStatus"/>
			<init>
				<method id="Get" args="TokenID" />
			</init>
			<button id="Edit" title="Edit" >
				<wnd id="GPNUserUpdate" args="TokenID" />
			</button>
			<button id="Cancel" title="Cancel">
				<wnd id="GPNUserList" />
			</button>	
		</wnd>
		<method id="Add" >
			<arg field="LastName" />
			<arg field="FirstName" />
			<arg field="SecondName" />
			<arg field="Login" />
			<arg field="Password" />
			<arg field="PasswordConfirm"/>
        	        <arg field="GroupsList"/>
		</method>
		<method id="Update" >
			<arg field="TokenID" />
			<arg field="LastName" optional="yes" />
			<arg field="FirstName" optional="yes" />
			<arg field="SecondName" optional="yes" />
			<arg field="Login" optional="yes" />
<!--			<arg field="Password" optional="yes" />
			<arg field="PasswordConfirm" optional="yes" /> -->
        	        <arg field="GroupsList" optional="yes" />
        	        <arg field="UStatus" optional="yes" />
		</method>
		<wnd id="GPNUserUpdate" >
			<field id="TokenID" visibility="vo" ret="yes"/>
			<field id="LastName"/>
			<field id="FirstName"/>
			<field id="SecondName"/>
			<field id="Login"/>
			<field id="GroupsList"/>
			<field id="UStatus"/>
			<init>
				<method id="Get" args="TokenID" />
			</init>
			<button id="Update" title="Update" >
				<method id="Update" />
                                <wnd id="GPNUserGet" args="TokenID" />
			</button>
			<button id="Cancel" title="Cancel">
				<wnd id="GPNUserGet" args="TokenID" />
			</button>	
		</wnd>
		<method id="AddWithTokenID" category="add">
			<arg field="TokenID"/>
			<arg field="LastName"/>
			<arg field="FirstName"/>
			<arg field="SecondName"/>
			<arg field="Login"/>
			<arg field="Password"/>
			<arg field="PasswordConfirm"/>
			<arg field="GroupsList"/>
		</method>

		<method id="Activate" >
			<arg field="TokenID" />
		</method>
		<method id="Block" >
			<arg field="TokenID" />
		</method>
		<method id="GPNUserListGet" />
		<view id="GPNUserList" title="Пользователи">
			<column field="TokenID" ret="yes" />
			<column field="FullName" />
			<column field="Login" />
			<column field="Groups" />
			<column field="UStatus" />
			<init>
				<method id="GPNUserListGet" />
			</init>
			<button id="Activate" title="Активировать" >
				<method id="Activate" args="TokenID=GPNUserList.TokenID" />
                                <evt type="WM_REFRESH" id="GPNUserList"/>
			</button>
			<button id="Block" title="Блокировать" >
				<method id="Block" args="TokenID=GPNUserList.TokenID" />
                                <evt type="WM_REFRESH" id="GPNUserList"/>
			</button>
		</view>
	</class>

	<class id="Organization" title="Организация" >
		<fields>
			<OrgID type="ID" key="sk" title="Код организации" />
			<Name type="NAME" title="Название" notnull="yes" />
			<Address type="TEXT" title="Адрес" />
			<LAddress type="TEXT" title="Юридический адрес" />
			<IsExecuter type="BOOL" title="Подрядная организация" />
			<IsProducer type="BOOL" title="Производитель" />
			<IsShipper type="BOOL" title="Поставщик" />
		</fields>
		<view id="OrganizationList" title="Организации" >
			<column field="OrgID" ret="yes" />
			<column field="Name" ret="yes" />
			<column field="Address" />
			<column field="LAddress" />
		</view>
		<view id="ExecuterList" title="Организации" >
			<column field="OrgID" ret="yes" />
			<column field="Name" />
			<column field="Address" />
			<column field="LAddress" />
			<select>
				<and left-field="IsExecuter" compare="=" literal="BOOL_TRUE" />
			</select>
		</view>
		<view id="ProducerList" title="Организации" >
			<column field="OrgID" ret="yes" />
			<column field="Name" />
			<column field="Address" />
			<column field="LAddress" />
			<select>
				<and left-field="IsProducer" compare="=" literal="BOOL_TRUE" />
			</select>
		</view>
		<view id="ShipperList" title="Организации" >
			<column field="OrgID" ret="yes" />
			<column field="Name" />
			<column field="Address" />
			<column field="LAddress" />
			<select>
				<and left-field="IsShipper" compare="=" literal="BOOL_TRUE" />
			</select>
		</view>
	</class>

<!--	<class id="Employment" title="Работа" >
		<fields>
			<GPNUser key="pk" title="Код пользователя"/>
			<GPNProject key="pk" title="Код организации" />
		</fields>
	</class> -->

	<class id="MCProject" title="Проект" >
		<fields>
			<ProjectID type="ID" key="sk" title="Код проекта" />
			<Name type="NAME" title="Название проекта" notnull="yes" />
			<BDate type="DATE" title="Дата начала" notnull="yes"/>
			<EDate type="DATE" title="Дата окончания" notnull="yes"/>

			<Executer ref="Organization" title="Подрядная организация" src="/act/GPN/ExecuterList" />
		</fields>
		<folder id="MCProjectFolder" title="Проект">
			<field id="ProjectID" />
			<elem wnd="MCProjectGet" args="ProjectID" title="General" />
			<elem wnd="EquipmentPointList" args="ProjectID" title="Точки оборудования" />
			<elem wnd="EquipmentList" args="ProjectID" title="Оборудование" />
			<elem wnd="CalculationList" args="ProjectID" title="Расчеты" />
		</folder>
		<view id="MCProjectList" title="Проекты" >
			<column field="ProjectID" ret="yes" />
			<column field="Name" ret="yes" />
			<column field="BDate" />
			<column field="EDate" />
			<column field="Name" alias="executer" class="Organization" title="Подрядная организация" />

			<left-join with="Organization" alias="executer" >
				<and left-field="ExecuterOrgID" compare="=" right-alias="executer" right-class="Organization" right-field="OrgID" />
			</left-join>
		</view>
	</class>

    <class id="Calculation" title="Расчет">
        <fields>
            <CalcID type="ID" key="sk" title="Код расчета" />
            <MCProject/>
            <p1 type="DOUBLE" title="p1" />
            <p2 type="DOUBLE" title="p2" />

        </fields>

	<view id="CalculationList" title="Расчеты" >
		<column field="CalcID" />
		<column field="ProjectID" class="MCProject" />
		<column field="Name" class="MCProject" />
		<select>
                                <and left-field="ProjectID" compare="=" right-class="MCProject" right-field="ProjectID" />
		</select>
	</view>

    </class>

	<class id="EquipmentPoint" title="Точка оборудования" >
		<fields>
			<PointID type="ID" key="sk" title="Код точки" hidden="yes" />
			<MCProject notnull="yes" title="Проект"/>
			<Name type="NAME" notnull="yes" title="Название точки" />
			<Number type="NAME" notnull="yes" title="Номер точки" />
			<PointType type="POINT_TYPE" notnull="yes" title="Тип точки" />
			<X type="DOUBLE" notnull="yes" title="Долгота" min="-180" max="180" decimal-accuracy="10" />
			<Y type="DOUBLE" notnull="yes" title="Широта" min="-90" max="90" decimal-accuracy="10" />
			<H type="DOUBLE" title="Глубина" />
		</fields>

		<view id="EquipmentPointList" title="Точка оборудования" >
			<column field="PointID" ret="yes" />
			<column field="Name" ret="yes" />
			<column field="Number" />
			<column field="ProjectID" />
			<column field="Name" class="MCProject" alias="mcp" />
			<column field="PointType" />
			<column field="X" />
			<column field="Y" />
			<column field="H" />
                        <select>
                                <and left-field="ProjectID" compare="=" right-alias="mcp" right-class="MCProject" right-field="ProjectID" />
			</select>
		</view>
	</class>
	<class id="EquipmentKind" title="Типы оборудования" >
		<fields>
			<EquipKindID type="ID" key="sk" title="Код типа оборудования" hidden="yes" />
			<Kind type="EQUIP_KIND" title="Оборудование" />
			<Name type="NAME" title="Модель" />
	                <Producer ref="Organization" src="/act/GPN/ProducerList" notnull="yes" title="Производитель" />
		</fields>
		<view id="EquipmentKindList" title="Типы оборудования" >
			<column field="EquipKindID" ret="yes" />
			<column field="Name" ret="yes" />
			<column field="OrgID" class="Organization" alias="Producer" title="Код поставщика" />
			<column field="Name" class="Organization" alias="Producer" title="Поставщик"/>
			<select>
				<and left-field="ProducerOrgID" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
			</select>
		</view>
		<view id="UmbilicalCableMenuList" title="Типы оборудования" >
			<column field="EquipKindID" ret="yes" />
			<column field="Name" />
			<column field="OrgID" class="Organization" alias="Producer" title="Код поставщика" />
			<column field="Name" class="Organization" alias="Producer" title="Поставщик" />
			<select>
				<and left-field="Kind" compare="=" literal="UMBILICAL_CABLE" />
				<and left-field="ProducerOrgID" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
			</select>
		</view>
		<view id="PompMenuList" title="Типы оборудования" >
			<column field="EquipKindID" ret="yes" />
			<column field="Name" />
			<column field="OrgID" class="Organization" alias="Producer" title="Код поставщика"/>
			<column field="Name" class="Organization" alias="Producer" title="Поставщик"/>
			<select>
				<and left-field="Kind" compare="=" literal="POMP" />
				<and left-field="ProducerOrgID" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
			</select>
		</view>
		<view id="GateValvesMenuList" title="Типы оборудования" >
			<column field="EquipKindID" ret="yes" />
			<column field="Name" />
			<column field="OrgID" class="Organization" alias="Producer" title="Код поставщика"/>
			<column field="Name" class="Organization" alias="Producer" title="Поставщик"/>
			<select>
				<and left-field="Kind" compare="=" literal="GATE_VALVES" />
				<and left-field="ProducerOrgID" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
			</select>
		</view>
	</class>


	<class id="Equipment" title="Оборудование" >
		<fields>
			<EquipID type="ID" key="sk" title="Код записи" hidden="yes" />
			<EquipmentKind title="Оборудование" notnull="yes" />

			<Point1 ref="EquipmentPoint" notnull="yes" title="Точка оборудования" />
			<Point2 ref="EquipmentPoint" title="Точка оборудования" />
                        <InvNumber type="NAME" notnull="yes" title="Инвентаризационный номер оборудования" />
                        <Shipper ref="Organization" src="/act/GPN/ShipperList" notnull="yes" title="Поставщик" />

			<EStatus type="EQUIPMENT_STATUS" title="Статус" notnull="yes" />
			<EState type="EQUIPMENT_STATE" title="Состояние" notnull="yes" />


		</fields>
                <view id="EquipmentList" title="Оборудование проектов" exclude="AddEquipment" >
                        <column field="EquipID" ret="yes"/>
                        <column field="ProjectID" class="MCProject" alias="mcp" />
                        <column field="Name" class="MCProject" alias="mcp" />
                        <column field="Kind" class="EquipmentKind" alias="EType" title="Оборудование" />
                        <column field="Name" class="EquipmentKind" alias="EType" title="Оборудование" />
                        <column field="Name" class="Organization" alias="Producer" title="Производитель" />
                        <column field="PointID" class="EquipmentPoint" alias="Point1" />
                        <column field="Name" class="EquipmentPoint" alias="Point1" />
                        <column field="PointID" class="EquipmentPoint" alias="Point2" />
                        <column field="Name" class="EquipmentPoint" alias="Point2" />
                        <column field="InvNumber" />
                        <column field="Name" class="Organization" alias="Shipper" title="Поставщик" />
			<column field="EStatus" />

                       <left-join with="EquipmentPoint" alias="Point2" >
                                <and left-field="Point2PointID" compare="=" right-alias="Point2" right-class="EquipmentPoint" right-field="PointID" />
                                <and left-field="ProjectID" left-class="EquipmentPoint" left-alias="Point2" compare="=" right-alias="mcp" right-class="MCProject" right-field="ProjectID" />
			</left-join> 
                        <select>
				<and left-field="EquipKindID" compare="=" right-alias="EType" right-class="EquipmentKind" right-field="EquipKindID" />
				<and left-field="ProducerOrgID" left-class="EquipType" left-alias="EType" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
                                <and left-field="Point1PointID" compare="=" right-alias="Point1" right-class="EquipmentPoint" right-field="PointID" />
                                <and left-field="ProjectID" left-class="EquipmentPoint" left-alias="Point1" compare="=" right-alias="mcp" right-class="MCProject" right-field="ProjectID" />
				<and left-field="ShipperOrgID" compare="=" right-alias="Shipper" right-class="Organization" right-field="OrgID" />

                                <!--<and left-field="EAttrID" compare="=" right-alias="ea" right-class="EquipmentAttr" right-field="EAttrID" />-->
                        </select>

                </view>
                <view id="EquipmentMenuList" title="Оборудование проектов" exclude="AddEquipment" >
                        <column field="EquipID" ret="yes"/>
                        <column field="ProjectID" class="MCProject" alias="mcp" />
                        <column field="Name" class="MCProject" alias="mcp" />
                        <column field="Kind" class="EquipmentKind" alias="EType" title="Оборудование" />
                        <column field="Name" class="EquipmentKind" alias="EType" title="Модель" />
                        <column field="Name" class="Organization" alias="Producer" title="Производитель" />
                        <column field="InvNumber" />
                        <column field="Name" class="Organization" alias="Shipper" title="Поставщик" />
			<column field="EStatus" />
			<column field="EState" />

                        <select>
				<and left-field="EquipKindID" compare="=" right-alias="EType" right-class="EquipmentKind" right-field="EquipKindID" />
				<and left-field="ProducerOrgID" left-class="EquipType" left-alias="EType" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
				<and left-field="ShipperOrgID" compare="=" right-alias="Shipper" right-class="Organization" right-field="OrgID" />
                        </select>

                </view>


	</class>
	<class id="UmbilicalCable" title="Шлангокабель" parent="Equipment" >
		<fields>
			<Length type="DOUBLE" notnull="yes" title="Длина" />
			<Diameter type="DOUBLE" notnull="yes" title="Диаметр" />
		</fields>
		<view id="UmbilicalCableList" title="Шлангокабели" exclude="AddUmbilicalCable Delete ">
			<column field="EquipID" />
			<column field="EquipKindID" class="EquipmentKind" alis="EKind" />
			<column field="Name" class="EquipmentKind" alis="EKind" />
                        <column field="Point1PointID" class="Equipment" />
                        <column field="Name" alias="Point1" class="EquipmentPoint" />
                        <column field="Point2PointID" class="Equipment"/>
                        <column field="Name" alias="Point2" class="EquipmentPoint" />
                        <column field="InvNumber" class="Equipment" />
                        <column field="Name" class="Organization" alias="Producer" />
                        <column field="Name" class="Organization" alias="Shipper" />
			<column field="Length" />
			<column field="Diameter" />
                        <select>
				<and left-field="EquipID" compare="=" right-class="Equipment" right-field="EquipID" />
				<and left-field="EquipKindID" left-class="Equipment" compare="=" right-alias="EKind" right-class="EquipmentKind" right-field="EquipKindID" />
                                <and left-field="Point1PointID" left-class="Equipment" compare="=" right-alias="Point1" right-class="EquipmentPoint" right-field="PointID" />
                                <and left-field="Point2PointID" left-class="Equipment" compare="=" right-alias="Point2" right-class="EquipmentPoint" right-field="PointID" />
				<and left-field="ProducerOrgID" left-class="EquipmentKind" left-alias="EKind" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
				<and left-field="ShipperOrgID" left-class="Equipment" compare="=" right-alias="Shipper" right-class="Organization" right-field="OrgID" />
                        </select>
		</view>
	</class>
	<class id="Pomp" title="Насос" parent="Equipment" >
		<fields>
			<Power type="DOUBLE" notnull="yes" title="Мощность" />
			<Capacity type="INT" notnull="yes" title="Производительность" />
		</fields>
		<view id="PompList" title="Насосы" exclude="AddPomp Delete ">
			<column field="EquipID" />
			<column field="EquipKindID" class="EquipmentKind" alis="EKind" />
			<column field="Name" class="EquipmentKind" alis="EKind" />
                        <column field="Point1PointID" class="Equipment" />
                        <column field="Name" alias="Point1" class="EquipmentPoint" />
                        <column field="InvNumber" class="Equipment" />
                        <column field="Name" class="Organization" alias="Producer" />
                        <column field="Name" class="Organization" alias="Shipper" />
			<column field="Power" />
			<column field="Capacity" />
                        <select>
				<and left-field="EquipID" compare="=" right-class="Equipment" right-field="EquipID" />
				<and left-field="EquipKindID" left-class="Equipment" compare="=" right-alias="EKind" right-class="EquipmentKind" right-field="EquipKindID" />
                                <and left-field="Point1PointID" left-class="Equipment" compare="=" right-alias="Point1" right-class="EquipmentPoint" right-field="PointID" />
				<and left-field="ProducerOrgID" left-class="EquipmentKind" left-alias="EKind" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
				<and left-field="ShipperOrgID" left-class="Equipment" compare="=" right-alias="Shipper" right-class="Organization" right-field="OrgID" />
                        </select>
		</view>
	</class>

	<class id="GateValves" title="Задвижки" parent="Equipment" >
		<fields>
			<Diameter type="DOUBLE" notnull="yes" title="Диаметр" />
		</fields>
		<view id="GateValvesList" title="Задвижки" exclude="AddGateValves Delete ">
			<column field="EquipID" />
			<column field="EquipKindID" class="EquipmentKind" alis="EKind" />
			<column field="Name" class="EquipmentKind" alis="EKind" />
                        <column field="Point1PointID" class="Equipment" />
                        <column field="Name" alias="Point1" class="EquipmentPoint" />
                        <column field="Point2PointID" class="Equipment"/>
                        <column field="Name" alias="Point2" class="EquipmentPoint" />
                        <column field="InvNumber" class="Equipment" />
                        <column field="Name" class="Organization" alias="Producer" />
                        <column field="Name" class="Organization" alias="Shipper" />
			<column field="Diameter" />
                        <select>
				<and left-field="EquipID" compare="=" right-class="Equipment" right-field="EquipID" />
				<and left-field="EquipKindID" left-class="Equipment" compare="=" right-alias="EKind" right-class="EquipmentKind" right-field="EquipKindID" />
                                <and left-field="Point1PointID" left-class="Equipment" compare="=" right-alias="Point1" right-class="EquipmentPoint" right-field="PointID" />
                                <and left-field="Point2PointID" left-class="Equipment" compare="=" right-alias="Point2" right-class="EquipmentPoint" right-field="PointID" />
				<and left-field="ProducerOrgID" left-class="EquipmentKind" left-alias="EKind" compare="=" right-alias="Producer" right-class="Organization" right-field="OrgID" />
				<and left-field="ShipperOrgID" left-class="Equipment" compare="=" right-alias="Shipper" right-class="Organization" right-field="OrgID" />
                        </select>
		</view>
	</class>


<menu id="MainMenu">
	<elem id="TreeRoot" title="GPN" >
		<elem id="Projects" title="Проекты" >
			<elem id="All" title="Проекты" src="/act/GPN/MCProjectList"/>
		</elem>
		<elem id="Equipments" title="Оборудование" >
			<elem id="EStore" title="Оборудование" src="/act/GPN/EquipmentMenuList"/>
		</elem>
		<elem id="Reports" title="Отчеты" >
		</elem>
		<elem id="Books" title="Справочники" >
			<elem id="OrgsBook" title="Организации" >
				<elem id="Executers" title="Подрядные организации" src="/act/GPN/ExecuterList" />
				<elem id="Producers" title="Производители" src="/act/GPN/ProducerList" />
				<elem id="Shippers" title="Поставщики" src="/act/GPN/ShipperList" />
			</elem>
			<elem id="EquipmentsBook" title="Оборудование" >
				<elem id="UmbilicalCablesBook" title="Шлангокабели" src="/act/GPN/UmbilicalCableMenuList" /> 
				<elem id="PompsBook" title="Насосы" src="/act/GPN/PompMenuList" />
				<elem id="GateValvesBook" title="Задвижки" src="/act/GPN/GateValvesMenuList" />
			</elem>
		</elem>
                <elem id="Settings" title="Настройки" >
                        <elem id="AccessControl" title="Доступ">
                                  <elem id="Groups" src="/act/Authorizer/GroupsList" title="Группы Доступа"/>
                                  <elem id="APrivileges" src="/act/Authorizer/APrivilegesList" title="Привилегии"/>
                                  <elem id="VC" src="/act/Authorizer/VCList" title="VC"/>
                        </elem>
			<elem id="QueryStore" title="Отчеты" src="/act/Reporter/QueryFolderStoredQueryList" />
                </elem>

<!--                <elem id="Groups" src="/act/GPN/GPNUserList" title="Пользователи"/> -->
		</elem>
        </menu>



</project>
